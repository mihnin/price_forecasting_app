import streamlit as st
import pandas as pd
import os
import sys

# –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ª–∏–º–∏—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ Pandas Styler
pd.set_option("styler.render.max_elements", 1000000)  # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ª–∏–º–∏—Ç –≤ 1 –º–∏–ª–ª–∏–æ–Ω —ç–ª–µ–º–µ–Ω—Ç–æ–≤

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ –º–æ–¥—É–ª—è–º
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –º–æ–¥—É–ª–∏
from modules.data_loader import DataLoader
from modules.data_processor import DataProcessor
from modules.data_analyzer import DataAnalyzer
from modules.visualization import Visualizer
from modules.material_segmentation import MaterialSegmenter
from modules.forecasting_preparation import ForecastPreparation
from modules.security_analyzer import SecurityAnalyzer
from modules.utils import apply_custom_css, show_user_guide, show_performance_info, show_app_version

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
st.set_page_config(
    page_title="–ê–Ω–∞–ª–∏–∑ –∏ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤",
    page_icon="üìä",
    layout="wide",
    initial_sidebar_state="expanded"
)

# –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π CSS
apply_custom_css()

# –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç—ã –º–æ–¥—É–ª–µ–π
data_loader = DataLoader()
data_processor = DataProcessor()
data_analyzer = DataAnalyzer()
visualizer = Visualizer()
material_segmenter = MaterialSegmenter()
forecast_preparation = ForecastPreparation()
security_analyzer = SecurityAnalyzer()

# –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å
with st.sidebar:
    st.header("–ù–∞–≤–∏–≥–∞—Ü–∏—è")
    page = st.radio(
        "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª:",
        ["–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è", "–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö", "–û–±—â–∏–π –∞–Ω–∞–ª–∏–∑", "–ê–Ω–∞–ª–∏–∑ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤", 
         "–í—Ä–µ–º–µ–Ω–Ω–æ–π –∞–Ω–∞–ª–∏–∑", "–ê–Ω–∞–ª–∏–∑ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏", "–°—Ç–∞–±–∏–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã", 
         "–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã", "–°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è", "–ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏", "–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö"]
    )
    
    st.divider()
    st.header("–°—Ç–∞—Ç—É—Å")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ —Å–µ—Å—Å–∏–∏
    if 'data' in st.session_state:
        st.success(f"–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã: {st.session_state.data.shape[0]} —Å—Ç—Ä–æ–∫")
        if 'processed_data' in st.session_state:
            st.success("–î–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã")
        if 'materials_segments' in st.session_state:
            st.success("–ú–∞—Ç–µ—Ä–∏–∞–ª—ã —Å–µ–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã")
            
            # –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ —Å–µ–≥–º–µ–Ω—Ç–∞–º
            segments_stats = st.session_state.get('segments_stats', {})
            if segments_stats:
                st.write("–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤:")
                for segment, count in segments_stats.items():
                    st.write(f"- {segment}: {count}")
    else:
        st.warning("–î–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã")

# –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
st.title("–ê–Ω–∞–ª–∏–∑ –∏ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤")

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
def display_info():
    st.info("""
    –≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–æ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞—Ö –∏ –∏—Ö —Ü–µ–Ω–∞—Ö, 
    –∞ —Ç–∞–∫–∂–µ –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—é —Ü–µ–Ω —Å –ø–æ–º–æ—â—å—é —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è.
    
    –ó–∞–≥—Ä—É–∑–∏—Ç–µ CSV-—Ñ–∞–π–ª —Å –¥–∞–Ω–Ω—ã–º–∏ –æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞—Ö, –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–∏—Ç –∞–Ω–∞–ª–∏–∑, 
    –æ–ø—Ä–µ–¥–µ–ª–∏—Ç –º–∞—Ç–µ—Ä–∏–∞–ª—ã, –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è, –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
    """)
    
    # –î–æ–±–∞–≤–ª—è–µ–º —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    with st.expander("–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è", expanded=False):
        show_user_guide()
        
    # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è —Å–ª—É–∂–± –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    with st.expander("–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —Å–ª—É–∂–± –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"):
        st.markdown("""
        ## –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è —Å–ª—É–∂–± –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
        
        –î–∞–Ω–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤–∫–ª—é—á–∞–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –≤ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞:
        - –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å–∫–∏–µ —Å—Ö–µ–º—ã
        - –ú–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ —Å —Ü–µ–Ω–∞–º–∏
        - –î—Ä–æ–±–ª–µ–Ω–∏–µ –∑–∞–∫—É–ø–æ–∫ –¥–ª—è –æ–±—Ö–æ–¥–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä
        - –ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤ –∫–æ–Ω—Ü–µ –æ—Ç—á–µ—Ç–Ω—ã—Ö –ø–µ—Ä–∏–æ–¥–æ–≤
        - –ù–µ—Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∑–∞–∫—É–ø–æ—á–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö
        
        ### –ö–ª—é—á–µ–≤—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Ä–∏—Å–∫–∞:
        
        1. **–í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å —Ü–µ–Ω**
           *   **–ß—Ç–æ —ç—Ç–æ:** –¶–µ–Ω–∞ –Ω–∞ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –º–∞—Ç–µ—Ä–∏–∞–ª –æ—á–µ–Ω—å —Å–∏–ª—å–Ω–æ –∫–æ–ª–µ–±–ª–µ—Ç—Å—è –º–µ–∂–¥—É –∑–∞–∫—É–ø–∫–∞–º–∏ –±–µ–∑ –≤–∏–¥–∏–º—ã—Ö —Ä—ã–Ω–æ—á–Ω—ã—Ö –ø—Ä–∏—á–∏–Ω.
           *   **–ö–∞–∫ –∏–∑–º–µ—Ä—è–µ—Ç—Å—è:** –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤–∞—Ä–∏–∞—Ü–∏–∏ (CV). –í—ã—Å–æ–∫–∏–º —Å—á–∏—Ç–∞–µ—Ç—Å—è CV > 50% (—Ü–µ–Ω–∞ –≤ —Å—Ä–µ–¥–Ω–µ–º –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è –±–æ–ª–µ–µ —á–µ–º –Ω–∞ –ø–æ–ª–æ–≤–∏–Ω—É –æ—Ç —Å—Ä–µ–¥–Ω–µ–π —Ü–µ–Ω—ã).
           *   **–ü—Ä–∏–º–µ—Ä:** –¶–µ–Ω–∞ –Ω–∞ "–ö–∞–±–µ–ª—å —Å–∏–ª–æ–≤–æ–π" –≤—á–µ—Ä–∞ –±—ã–ª–∞ 100 —Ä—É–±/–º–µ—Ç—Ä, —Å–µ–≥–æ–¥–Ω—è - 250 —Ä—É–±/–º–µ—Ç—Ä, –∞ —á–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é - 80 —Ä—É–±/–º–µ—Ç—Ä, –ø—Ä–∏ —ç—Ç–æ–º —Ä—ã–Ω–æ—á–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π –æ –¥–µ—Ñ–∏—Ü–∏—Ç–µ –∏–ª–∏ —Ä–µ–∑–∫–æ–º –ø–æ–¥–æ—Ä–æ–∂–∞–Ω–∏–∏ –º–µ–¥–∏ –Ω–µ –±—ã–ª–æ. –≠—Ç–æ –º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ –∏–ª–∏ –æ—à–∏–±–∫–∏.
        
        2. **–î—Ä–æ–±–ª–µ–Ω–∏–µ –∑–∞–∫—É–ø–æ–∫**
           *   **–ß—Ç–æ —ç—Ç–æ:** –í–º–µ—Å—Ç–æ –æ–¥–Ω–æ–π –∫—Ä—É–ø–Ω–æ–π –∑–∞–∫—É–ø–∫–∏ –ø—Ä–æ–≤–æ–¥–∏—Ç—Å—è –º–Ω–æ–∂–µ—Å—Ç–≤–æ –º–µ–ª–∫–∏—Ö, —á–∞—Å—Ç–æ —Å –Ω–µ–±–æ–ª—å—à–∏–º–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏ –≤—Ä–µ–º–µ–Ω–∏. –¶–µ–ª—å –º–æ–∂–µ—Ç –±—ã—Ç—å - –æ–±–æ–π—Ç–∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—É —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –∏–ª–∏ —Ç–µ–Ω–¥–µ—Ä–∞, –∫–æ—Ç–æ—Ä–∞—è —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –∑–∞–∫—É–ø–æ–∫ —Å–≤—ã—à–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Å—É–º–º—ã (–ø–æ—Ä–æ–≥–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è).
           *   **–ö–∞–∫ –∏–∑–º–µ—Ä—è–µ—Ç—Å—è:** –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —á–∞—Å—Ç–æ—Ç–∞ –∑–∞–∫—É–ø–æ–∫ –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –Ω–∞ —Å—É–º–º—ã, –±–ª–∏–∑–∫–∏–µ –∫ –ø–æ—Ä–æ–≥–æ–≤—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–∫—É–ø–∫–∏ –Ω–∞ 49 900 —Ä—É–± –ø—Ä–∏ –ø–æ—Ä–æ–≥–µ –≤ 50 000 —Ä—É–±).
           *   **–ü—Ä–∏–º–µ—Ä:** –í —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏ –∑–∞–∫—É–ø–∞–µ—Ç—Å—è "–ë—É–º–∞–≥–∞ –ê4" 5 —Ä–∞–∑ –ø–æ 45 000 —Ä—É–±, —Ö–æ—Ç—è –º–æ–∂–Ω–æ –±—ã–ª–æ —Å–¥–µ–ª–∞—Ç—å –æ–¥–Ω—É –∑–∞–∫—É–ø–∫—É –Ω–∞ 225 000 —Ä—É–±. –ï—Å–ª–∏ –ø–æ—Ä–æ–≥ –¥–ª—è —Ç–µ–Ω–¥–µ—Ä–∞ - 50 000 —Ä—É–±, —ç—Ç–æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ.
        
        3. **–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤ –∫–æ–Ω—Ü–µ –ø–µ—Ä–∏–æ–¥–æ–≤**
           *   **–ß—Ç–æ —ç—Ç–æ:** –ù–µ–ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫—É–ø–æ–∫ –∏–ª–∏ –ø–æ–≤—ã—à–µ–Ω–∏–µ —Ü–µ–Ω –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–Ω–∏ –æ—Ç—á–µ—Ç–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ (–º–µ—Å—è—Ü, –∫–≤–∞—Ä—Ç–∞–ª, –≥–æ–¥).
           *   **–ü—Ä–∏—á–∏–Ω–∞:** –ú–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –ø–æ–ø—ã—Ç–∫–∏ —Å—Ä–æ—á–Ω–æ "–æ—Å–≤–æ–∏—Ç—å –±—é–¥–∂–µ—Ç" –∏–ª–∏ –Ω–∞ —Å–ø–µ—à–∫—É, –≤–µ–¥—É—â—É—é –∫ –∑–∞–∫—É–ø–∫–∞–º –ø–æ –∑–∞–≤—ã—à–µ–Ω–Ω—ã–º —Ü–µ–Ω–∞–º.
           *   **–ü—Ä–∏–º–µ—Ä:** 80% –≤—Å–µ—Ö –∑–∞–∫—É–ø–æ–∫ "–ü—Ä–∏–Ω—Ç–µ—Ä–æ–≤" –∑–∞ –∫–≤–∞—Ä—Ç–∞–ª –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–≤–∞ –¥–Ω—è –º–∞—Ä—Ç–∞. –ò–ª–∏ —Ü–µ–Ω–∞ –Ω–∞ "–£—Å–ª—É–≥–∏ –∫–æ–Ω—Å–∞–ª—Ç–∏–Ω–≥–∞" —Å–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–≤—ã—à–∞–µ—Ç—Å—è –Ω–∞ 20% –≤ –¥–µ–∫–∞–±—Ä–µ.
        
        4. **–ê–Ω–æ–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ü–µ–Ω**
           *   **–ß—Ç–æ —ç—Ç–æ:** –¶–µ–Ω–∞ –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª –æ—Å—Ç–∞–µ—Ç—Å—è –∞–±—Å–æ–ª—é—Ç–Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏, –¥–∞–∂–µ –µ—Å–ª–∏ —Ä—ã–Ω–æ—á–Ω—ã–µ —Ü–µ–Ω—ã –Ω–∞ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –º–µ–Ω—è—é—Ç—Å—è. –¢–∞–∫–∂–µ —Å—é–¥–∞ –æ—Ç–Ω–æ—Å—è—Ç—Å—è –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ "–∫—Ä—É–≥–ª—ã–µ" —Ü–µ–Ω—ã.
           *   **–ü—Ä–∏—á–∏–Ω–∞:** –ú–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ —Å–≥–æ–≤–æ—Ä —Å –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–º, —Ñ–∏–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫—É–ø–∫–∏ –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–Ω–∞–ª–∏–∑–∞ —Ä—ã–Ω–∫–∞.
           *   **–ü—Ä–∏–º–µ—Ä:** –¶–µ–Ω–∞ –Ω–∞ "–ú–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–µ —Å—Ç–µ–ª–ª–∞–∂–∏" (—Ç–æ–≤–∞—Ä —Å –∏–∑–º–µ–Ω—è—é—â–µ–π—Å—è —Ü–µ–Ω–æ–π –º–µ—Ç–∞–ª–ª–∞) —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–æ–≤–Ω–æ 10 000.00 —Ä—É–± –∑–∞ —à—Ç—É–∫—É –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ –¥–≤—É—Ö –ª–µ—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π. –ò–ª–∏ —Ü–µ–Ω–∞ –≤—Å–µ–≥–¥–∞ —Ä–∞–≤–Ω–∞ 5000.00, 15000.00 –∏ —Ç.–¥.
        
        5. **–ù–∞—Ä—É—à–µ–Ω–∏—è —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏**
           *   **–ß—Ç–æ —ç—Ç–æ:** –ó–∞–∫—É–ø–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –ø–µ—Ä–∏–æ–¥—ã, –∫–æ–≥–¥–∞ —Å–ø—Ä–æ—Å –Ω–∞ –Ω–∏—Ö –º–∏–Ω–∏–º–∞–ª–µ–Ω –∏–ª–∏ –∫–æ–≥–¥–∞ –∏—Ö –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ/–ø–æ—Å—Ç–∞–≤–∫–∞ –æ–±—ã—á–Ω–æ –Ω–µ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è, –ª–∏–±–æ –¥–∏–Ω–∞–º–∏–∫–∞ —Ü–µ–Ω –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç –æ–±—â–∏–º —Ç–µ–Ω–¥–µ–Ω—Ü–∏—è–º.
           *   **–ü—Ä–∏—á–∏–Ω–∞:** –ú–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –∑–∞–∫—É–ø–∫—É "–ø—Ä–æ –∑–∞–ø–∞—Å" –ø–æ –Ω–µ–≤—ã–≥–æ–¥–Ω—ã–º —Ü–µ–Ω–∞–º –∏–ª–∏ –Ω–∞ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å—Ö–µ–º—ã.
           *   **–ü—Ä–∏–º–µ—Ä:** –ú–∞—Å—Å–æ–≤–∞—è –∑–∞–∫—É–ø–∫–∞ "–ù–æ–≤–æ–≥–æ–¥–Ω–∏—Ö —É–∫—Ä–∞—à–µ–Ω–∏–π" –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –∏—é–Ω–µ –ø–æ –≤—ã—Å–æ–∫–∏–º —Ü–µ–Ω–∞–º. –ò–ª–∏ —Ü–µ–Ω–∞ –Ω–∞ "–ö–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä—ã" —Ä–∞—Å—Ç–µ—Ç –∑–∏–º–æ–π, —Ö–æ—Ç—è –æ–±—ã—á–Ω–æ –≤ —ç—Ç–æ –≤—Ä–µ–º—è –æ–Ω–∞ –ø–∞–¥–∞–µ—Ç.
        
        ### –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å –∞–Ω–∞–ª–∏–∑–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
        
        1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∞–π—Ç–µ –¥–∞–Ω–Ω—ã–µ
        2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—é –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
        3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"
        4. –ò–∑—É—á–∏—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã —Å –≤—ã—Å–æ–∫–∏–º –∏–Ω–¥–µ–∫—Å–æ–º –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        5. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏–∑ –≥—Ä—É–ø–ø—ã —Ä–∏—Å–∫–∞
        6. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –æ—Ç—á–µ—Ç –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
        
        **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –û—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ —Å–ª–µ–¥—É–µ—Ç —É–¥–µ–ª–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º –∏–∑ —Å–µ–≥–º–µ–Ω—Ç–∞ "–í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å", —Ç–∞–∫ –∫–∞–∫ –≤ —ç—Ç–æ–º —Å–µ–≥–º–µ–Ω—Ç–µ –Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç–æ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç—Å—è –ø—Ä–∏–∑–Ω–∞–∫–∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π.
        """)

# –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
if page == "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è":
    display_info()

elif page == "–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö":
    data_loader.render()
    
    if 'data' in st.session_state:
        if st.button("–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ"):
            with st.spinner("–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö..."):
                st.session_state.processed_data = data_processor.process_data(st.session_state.data)
                st.success("–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã!")
                
                # –ü–æ–∫–∞–∑–∞—Ç—å –æ–±—Ä–∞–∑–µ—Ü –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                st.subheader("–û–±—Ä–∞–∑–µ—Ü –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö")
                st.dataframe(st.session_state.processed_data.head())

elif page == "–û–±—â–∏–π –∞–Ω–∞–ª–∏–∑":
    if 'processed_data' in st.session_state:
        data_analyzer.render_overview(st.session_state.processed_data)
    else:
        st.warning("–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∞–π—Ç–µ –¥–∞–Ω–Ω—ã–µ")

elif page == "–ê–Ω–∞–ª–∏–∑ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤":
    if 'processed_data' in st.session_state:
        data_analyzer.render_materials_uniqueness(st.session_state.processed_data)
        visualizer.plot_materials_distribution(st.session_state.processed_data)
    else:
        st.warning("–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∞–π—Ç–µ –¥–∞–Ω–Ω—ã–µ")

elif page == "–í—Ä–µ–º–µ–Ω–Ω–æ–π –∞–Ω–∞–ª–∏–∑":
    if 'processed_data' in st.session_state:
        data_analyzer.render_time_analysis(st.session_state.processed_data)
        visualizer.plot_time_distribution(st.session_state.processed_data)
    else:
        st.warning("–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∞–π—Ç–µ –¥–∞–Ω–Ω—ã–µ")

elif page == "–ê–Ω–∞–ª–∏–∑ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏":
    if 'processed_data' in st.session_state:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –¥–∞–Ω–Ω—ã–µ –∞–Ω–∞–ª–∏–∑–∞ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
        if 'volatility_data' not in st.session_state:
            with st.spinner("–ê–Ω–∞–ª–∏–∑ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏..."):
                # –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ st.session_state.volatility_data
                material_segmenter.analyze_volatility(st.session_state.processed_data)

        # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –µ—Å—Ç—å (–±—ã–ª–∏ –∏–ª–∏ —Ç–æ–ª—å–∫–æ —á—Ç–æ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã)
        if 'volatility_data' in st.session_state:
            visualizer.plot_volatility(st.session_state.volatility_data)
        else:
            st.error("–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∞–Ω–∞–ª–∏–∑–∞ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏.")
    else:
        st.warning("–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∞–π—Ç–µ –¥–∞–Ω–Ω—ã–µ")

elif page == "–°—Ç–∞–±–∏–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã":
    if 'processed_data' in st.session_state:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –¥–∞–Ω–Ω—ã–µ –∞–Ω–∞–ª–∏–∑–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
        if 'stability_data' not in st.session_state:
            with st.spinner("–ê–Ω–∞–ª–∏–∑ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤..."):
                 # –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ st.session_state.stability_data
                material_segmenter.analyze_stability(st.session_state.processed_data)

        # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –µ—Å—Ç—å
        if 'stability_data' in st.session_state:
            visualizer.plot_stability(st.session_state.stability_data)
        else:
            st.error("–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∞–Ω–∞–ª–∏–∑–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏.")
    else:
        st.warning("–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∞–π—Ç–µ –¥–∞–Ω–Ω—ã–µ")

elif page == "–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã":
    if 'processed_data' in st.session_state:
         # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –¥–∞–Ω–Ω—ã–µ –∞–Ω–∞–ª–∏–∑–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        if 'inactivity_data' not in st.session_state:
            with st.spinner("–ê–Ω–∞–ª–∏–∑ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤..."):
                 # –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ st.session_state.inactivity_data
                material_segmenter.analyze_inactivity(st.session_state.processed_data)

        # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –µ—Å—Ç—å
        if 'inactivity_data' in st.session_state:
            visualizer.plot_inactivity(st.session_state.inactivity_data)
        else:
             st.error("–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∞–Ω–∞–ª–∏–∑–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.")
    else:
        st.warning("–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∞–π—Ç–µ –¥–∞–Ω–Ω—ã–µ")

elif page == "–°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è":
    if 'processed_data' in st.session_state:
        st.header("–°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è")
        
        # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏
        with st.expander("–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏", expanded=True):
            col1, col2, col3 = st.columns(3)
            
            with col1:
                min_data_points = st.slider("–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö", 5, 100, 24)
            
            with col2:
                max_volatility = st.slider("–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤–∞—Ä–∏–∞—Ü–∏–∏ (%)", 1, 100, 30)
            
            with col3:
                min_activity_days = st.slider("–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏", 30, 1000, 365)
        
        if st.button("–í—ã–ø–æ–ª–Ω–∏—Ç—å —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—é"):
            with st.spinner("–°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤..."):
                segments, stats = forecast_preparation.segment_materials(
                    st.session_state.processed_data,
                    min_data_points=min_data_points,
                    max_volatility=max_volatility,
                    min_activity_days=min_activity_days
                )

                st.session_state.materials_segments = segments
                st.session_state.segments_stats = stats

                st.success("–°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")

                # –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–æ–≤ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –Ω–æ–≤–æ–π —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏
                keys_to_clear = ['vis_seg_details_select', 'vis_seg_page_size', 'vis_seg_page_number']
                for key in keys_to_clear:
                    if key in st.session_state:
                        del st.session_state[key]
                # –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –≤—ã–∑—ã–≤–∞–µ–º –Ω–∏–∂–µ, –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ —Å–µ—Å—Å–∏–∏

        # –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å –≤ —Å–µ—Å—Å–∏–∏
        if 'materials_segments' in st.session_state and 'segments_stats' in st.session_state:
             # –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ session_state
             visualizer.plot_segmentation_results(
                 st.session_state.materials_segments,
                 st.session_state.segments_stats
             )
        # –°–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –µ—â–µ –Ω–µ –ø—Ä–æ–≤–æ–¥–∏–ª–∞—Å—å (–Ω–æ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã)
        elif 'materials_segments' not in st.session_state:
             st.info("–ó–∞–¥–∞–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –Ω–∞–∂–º–∏—Ç–µ '–í—ã–ø–æ–ª–Ω–∏—Ç—å —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—é' –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.")

    else:
        st.warning("–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∞–π—Ç–µ –¥–∞–Ω–Ω—ã–µ")
elif page == "–ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏":
    if 'processed_data' in st.session_state and 'materials_segments' in st.session_state:

        # –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –∞–Ω–∞–ª–∏–∑–∞
        if st.button("–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∞–Ω–∞–ª–∏–∑"):
            if 'security_risks' in st.session_state:
                del st.session_state['security_risks']
            st.rerun()

        # –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∞–ª–∏–∑ –¢–û–õ–¨–ö–û –µ—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –µ—â–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ —Å–µ—Å—Å–∏–∏
        if 'security_risks' not in st.session_state:
            with st.spinner("–ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö..."):
                st.session_state.security_risks = security_analyzer.analyze_security_risks(
                    st.session_state.processed_data,
                    st.session_state.materials_segments
                )

        # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
        if 'security_risks' in st.session_state and st.session_state.security_risks is not None and not st.session_state.security_risks.empty:
            risk_df = st.session_state.security_risks
            security_analyzer.display_security_analysis_results(risk_df)

            st.divider()
            st.subheader("–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ —Å –≤—ã—Å–æ–∫–∏–º —Ä–∏—Å–∫–æ–º")

            high_risk_materials_df = risk_df[risk_df['–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ä–∏—Å–∫–∞'] == '–í—ã—Å–æ–∫–∏–π']

            if not high_risk_materials_df.empty:
                high_risk_options = high_risk_materials_df['–ú–∞—Ç–µ—Ä–∏–∞–ª'].tolist()
                
                selected_materials = st.multiselect(
                    "–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞:",
                    options=high_risk_options,
                    default=high_risk_options[:min(5, len(high_risk_options))] # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–µ 5 –∏–ª–∏ –º–µ–Ω—å—à–µ
                )

                if selected_materials:
                    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è Excel
                    excel_data = security_analyzer.export_multiple_detailed_analysis(
                        st.session_state.processed_data, 
                        selected_materials
                    )
                    
                    if excel_data:
                        st.download_button(
                           label="–°–∫–∞—á–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ (Excel)",
                           data=excel_data,
                           file_name="detailed_security_analysis_multiple.xlsx",
                           mime="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
                        )
                else:
                    st.info("–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –º–∞—Ç–µ—Ä–∏–∞–ª –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.")
            else:
                st.info("–ú–∞—Ç–µ—Ä–∏–∞–ª—ã —Å –≤—ã—Å–æ–∫–∏–º —Ä–∏—Å–∫–æ–º –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.")

        elif 'security_risks' in st.session_state and st.session_state.security_risks is not None and st.session_state.security_risks.empty:
             st.info("–ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∑–∞–≤–µ—Ä—à–µ–Ω, –Ω–æ –º–∞—Ç–µ—Ä–∏–∞–ª—ã —Å –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏ —Ä–∏—Å–∫–∞ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã.")
        else:
             st.info("–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∏–ª–∏ –Ω–µ –±—ã–ª–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã.")

    elif 'processed_data' not in st.session_state:
        st.warning("–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∞–π—Ç–µ –¥–∞–Ω–Ω—ã–µ")
    else:
        st.warning("–°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—é –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –≤ —Ä–∞–∑–¥–µ–ª–µ '–°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è'")
        
        if st.button("–ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏"):
            st.session_state.page = "–°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è"
            st.rerun()
    
elif page == "–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö":
    if 'materials_segments' in st.session_state:
        st.header("–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö")
        
        st.markdown("""
        ## –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö
        
        –í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –≤—ã –º–æ–∂–µ—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ 
        –≤ —Ñ–æ—Ä–º–∞—Ç—ã CSV –∏–ª–∏ Excel –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö.
        
        –î–æ—Å—Ç—É–ø–Ω—ã–µ –æ–ø—Ü–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞:
        - **–≠–∫—Å–ø–æ—Ä—Ç –ø–æ —Å–µ–≥–º–µ–Ω—Ç–∞–º** - —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞
        - **–ú–∞—Å—Å–æ–≤—ã–π —ç–∫—Å–ø–æ—Ä—Ç** - —ç–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –≤ –æ–¥–∏–Ω ZIP-–∞—Ä—Ö–∏–≤
        - **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π —ç–∫—Å–ø–æ—Ä—Ç** - —ç–∫—Å–ø–æ—Ä—Ç —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Ä–∞–∑–ª–∏—á–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º
        """)
        
        # –í—ã–∑—ã–≤–∞–µ–º –º–µ—Ç–æ–¥ —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
        forecast_preparation.export_data_options(st.session_state.materials_segments)
    else:
        st.warning("–°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—é –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –≤ —Ä–∞–∑–¥–µ–ª–µ '–°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è'")
        
        if st.button("–ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏"):
            # –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏
            st.session_state.page = "–°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è"
            st.rerun()

# Footer
st.divider()

# –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
show_performance_info()

# –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤–µ—Ä—Å–∏–∏
show_app_version()

st.caption("¬© 2025 –ê–Ω–∞–ª–∏–∑ –∏ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤")